var touchJS=jQuery.noConflict();var WPtouchWebApp=navigator.standalone;var iOS5=navigator.userAgent.match("OS 5_");var addToHomeConfig={animationIn:"drop",animationOut:"bubble",startDelay:550,lifespan:1000*60,expire:60*24*WPtouch.expiryDays,bottomOffset:14,touchIcon:true,arrow:true,message:WPtouch.add2home_message};if(window.top!=window.self){window.top.location=self.location.href}if(typeof ontouchstart!="undefined"&&typeof ontouchend!="undefined"){var touchStartOrClick="touchstart";var touchEndOrClick="touchend"}else{var touchStartOrClick="click";var touchEndOrClick="click"}function doClassiciPadReady(){if(iOS5){var h=touchJS("#wptouch-header, #logo-area, .popover header");h.bind("touchmove",function(l){l.preventDefault()})}else{document.addEventListener("touchmove",function(l){l.preventDefault()},false);var e=touchJS("select, input, textarea");e.bind(touchStartOrClick,function(l){l.stopPropagation()})}window.addEventListener("orientationchange",function(){classicUpdateOrientation()});touchJS(".head-left div.menubar-button").bind(touchEndOrClick,function(){var m="#pop-"+touchJS(this).attr("id");var l=touchJS(this).offset();touchJS(m).css({top:"40px",left:l.left+"px"}).popOverToggle();touchJS(m+" .menu-pointer-arrow").css("left","20px");headerDismissSpan();scrollerRefresh()});touchJS(".head-right div.menubar-button").bind(touchEndOrClick,function(){var m="#pop-"+touchJS(this).attr("id");var l=touchJS(this).offset();touchJS(m).css({top:"40px",left:l.left-touchJS(m).width()/1.45}).popOverToggle();touchJS(m+" .menu-pointer-arrow").css("right","58px");headerDismissSpan();scrollerRefresh()});if(!iOS5){touchJS(".head-center h1").bind(touchStartOrClick,function(){var l=touchJS("#iscroll-wrapper").data("scroller");l.scrollTo(0,0,500)})}touchJS(function(){var l=touchJS("#pop-blog > div");touchJS("ul.menu-tabs a").bind(touchStartOrClick,function(m){l.hide().filter(this.rel).show();touchJS("ul.menu-tabs a").removeClass("selected");touchJS(this).addClass("selected");m.preventDefault();scrollerRefresh()}).filter(":first").trigger(touchStartOrClick)});touchJS("#popovers-container .pop-inner li a, #pages-wrapper a").live("click",function(){touchJS(this).parent().toggleClass("highlight")});var b=".button, .content a, .title-area a, .footer a, ol.commentlist a";touchJS(b).live(touchStartOrClick,function(){touchJS(this).addClass("active")}).live(touchEndOrClick,function(){touchJS(this).removeClass("active")});touchJS("#pages-wrapper").find("li.has_children ul").hide();touchJS("#pages-wrapper ul li.has_children > a").unbind("click").bind("click",function(){touchJS(this).next().webkitSlideToggle(350);touchJS(this).toggleClass("arrow-toggle");touchJS(this).parent().toggleClass("open-tree");scrollerRefresh();return false});touchJS("a.share-post").unbind("click").bind("click",function(){var l=touchJS(this).offset();touchJS("#share-popover").css({top:l.top-260+"px",left:l.left-25+"px",}).fadeIn(350);headerDismissSpan();return false});touchJS("#respond").detach().appendTo(".comment-reply-box .pop-inner").css("display","block");touchJS("#share-placeholder").detach().appendTo("#share-popover").css("display","block");touchJS(".leave-a-comment, span.comments-close-button").unbind("click").bind("click",function(){touchJS(".comment-reply-box").toggleClass("fly-in").flyInToggle();touchJS("input#comment_parent").val("0");touchJS("#box-head h3").html(WPtouch.leave_a_comment);touchJS("#peek").hide();touchJS("#container1 textarea").removeClass("reply");touchJS("#commentform input, #commentform textarea").blur();return false});touchJS("#peek").unbind("click").bind("click",function(){touchJS("#container1").toggleClass("slide");touchJS("#container2").toggleClass("slide2");return false});touchJS("a.comment-reply-login, a.reply-to-comment").unbind("click").bind(touchStartOrClick,function(){touchJS("#account.menubar-button").trigger(touchEndOrClick);return false});if(touchJS(".post").length){touchJS(".content img, .content .wp-caption").each(function(){if(touchJS(this).width()>=350){touchJS(this).addClass("aligncenter")}})}if(!iOS5){touchJS("textarea, form#prowl-direct-message input, form#loginform input, .content input").bind("blur",function(){scrollTo(0,0,100)})}touchJS("li#instapaper a").click(function(){var m=prompt(WPtouch.instapaper_username,"");if(m){var l=prompt(WPtouch.instapaper_password,"");if(!l){l="default"}var n={url:document.location.href,username:m,password:l,title:document.title};WPtouchAjax("instapaper",n,function(o){if(o=="1"){alert(WPtouch.instapaper_saved);touchJS("#share-popover").fadeOut(350)}else{alert(WPtouch.instapaper_try_again)}})}return false});var a=document.location;var k={beforeSubmit:function(){touchJS("#container1").append('<div id="comment-spinner"></div>')},success:function(){touchJS("ol.commentlist").load(a+" ol.commentlist > li",function(){touchJS("#comment-spinner").remove();touchJS("#container1 textarea").addClass("success");commentReplyLinks()});setTimeout(function(){touchJS(".comments-close-button").trigger("click");touchJS("#container1 textarea").removeClass("success");scrollerRefresh()},1500)},error:function(){touchJS("#comment-spinner").remove();touchJS("#container1 textarea").addClass("error");touchJS("#container1").prepend('<div id="error-text">'+WPtouch.comment_failure+"</div>");setTimeout(function(){touchJS("#container1 textarea").removeClass("error");touchJS("#error-text").remove()},3000)},resetForm:true,timeout:7500};if(touchJS.isFunction(touchJS.fn.ajaxForm)){touchJS("#commentform").ajaxForm(k)}var f={beforeSubmit:function j(o,n,l){for(var m=0;m<o.length;m++){if(!o[m].value){alert(WPtouch.validation_message);return false}touchJS("#prowl-direct-message p").prepend('<div id="prowl-spinner"></div>')}},success:function(){touchJS("#prowl-spinner").remove();touchJS("#prowl-direct-message textarea").addClass("success");setTimeout(function(){touchJS("#message").trigger(touchEndOrClick);touchJS("#prowl-direct-message textarea").removeClass("success")},1000)},error:function(){touchJS("#prowl-spinner").remove();touchJS("#prowl-direct-message textarea").addClass("error");touchJS("#prowl-direct-message").prepend('<div id="prowl-error-text">'+WPtouch.prowl_failure+"</div>");setTimeout(function(){touchJS("#prowl-direct-message textarea").removeClass("error");touchJS("#prowl-error-text").remove()},4000)},resetForm:true,timeout:3500};if(touchJS.isFunction(touchJS.fn.ajaxForm)){touchJS("#prowl-direct-message").ajaxForm(f)}touchJS(window).load(function(){if(touchJS("#welcome-message").length){touchJS("#welcome-message").show()}setTimeout(function(){scrollerRefresh()},0)});touchJS(function(){var l=1;touchJS("input, select, textarea").each(function(){if(this.type!="hidden"){var m=touchJS(this);m.attr("tabindex",l);l++}})});var i=WPtouch.toggle_on;touchJS(".on").text(i);var c=WPtouch.toggle_off;touchJS(".off").text(c);touchJS("#switch div").bind(touchEndOrClick,function(){var l=touchJS(this).attr("title");touchJS(".on").toggleClass("active");touchJS(".off").toggleClass("active");setTimeout(function(){window.location=l},500);return false});var d=["iframe[src^='http://player.vimeo.com']","iframe[src^='http://www.youtube.com']","iframe[src^='http://www.kickstarter.com']","object","embed","video"];var g=touchJS(".content").find(d.join(","));touchJS(g).each(function(){touchJS(this).unwrap().addClass("wptouch-videos").parentsUntil(".content","div:not(.fluid-width-video-wrapper), span").removeAttr("width").removeAttr("height").removeAttr("style")});touchJS(".content").fitVids();classicUpdateOrientation();loadMoreEntries();commentReplyLinks();loadMoreComments();welcomeMessage();webAppLinks();webAppOnly();setupScrolls();classicHandleShortcodes()}function setupScrolls(){if(!iOS5){touchJS(".iscroller").each(function(){var a=touchJS(this).attr("id");activeScroller=new iScroll(a);touchJS(this).data("scroller",activeScroller)})}}function scrollerRefresh(){if(!iOS5){var b=touchJS(".iscroller").filter(":visible").data("scroller");var a=touchJS("#iscroll-wrapper").data("scroller");setTimeout(function(){b.refresh();a.refresh()},0)}else{return true}}function classicUpdateOrientation(){var d=touchJS(window).height()-44;var a=touchJS("#logo-area").height();var c=d-a;var b=WPtouchReadCookie("wptouch-ipad-orientation");switch(window.orientation){case 0:case 180:touchJS("body").removeClass("landscape").addClass("portrait");touchJS("#iscroll-wrapper").css("height",d);touchJS("#main-menu #pages-wrapper").detach().appendTo("#pop-menu .pop-inner").css("height","auto").css("max-height","500px");touchJS(".popover.open").each(function(){touchJS(this).removeClass("open").hide()});WPtouchCreateCookie("wptouch-ipad-orientation","portrait",365);break;case 90:case -90:default:touchJS("body").removeClass("portrait").addClass("landscape");touchJS("#iscroll-wrapper").css("height",d);touchJS("#pages-wrapper").detach().css("height",c).css("max-height","none").appendTo("#main-menu");touchJS(".popover.open").each(function(){touchJS(this).removeClass("open").hide()});WPtouchCreateCookie("wptouch-ipad-orientation","landscape",365)}if(!iOS5){setTimeout(function(){var e=touchJS("#iscroll-wrapper").data("scroller");e.refresh()},550)}}function headerDismissSpan(){if(!touchJS("#dismiss-underlay").length){touchJS("body").append('<span id="dismiss-underlay"></span>');touchJS("#dismiss-underlay").bind(touchStartOrClick,function(a){touchJS(this).remove();touchJS("#popovers-container .popover.open").removeClass("open").fadeOut(350);touchJS("#share-popover").fadeOut(350);return false})}else{touchJS("#dismiss-underlay").remove()}}function classicHandleShortcodes(){if(WPtouchWebApp){var a=jQuery(".wptouch-shortcode-webapp-only");if(a.length){a.show()}}}function loadMoreEntries(){var a=touchJS("a.load-more-link");var b=".ajax-page-target";if(a.length){a.unbind("click").live("click",function(){touchJS("a.load-more-link span").addClass("ajax-spinner");var c=touchJS(this).attr("href");touchJS("#content").append("<div class='ajax-page-target'></div>");touchJS(b).hide().load(c+" #content .post, #content .load-more-link",function(){touchJS(this).replaceWith(touchJS(this).html());touchJS("span.ajax-spinner").parent().fadeOut(350);webAppLinks();scrollerRefresh();touchJS(".content").fitVids()});return false})}}function loadMoreComments(){var a=touchJS("ol.commentlist li.load-more-comments-link a");if(a.length){a.unbind("click").live("click",function(){var b=touchJS(this).attr("href");touchJS(this).addClass("ajax-spinner").delay(1250).fadeOut(350);touchJS("ol.commentlist").append("<div class='ajax-page-target'></div>");touchJS("div.ajax-page-target").hide().load(b+" ol.commentlist > li",function(){touchJS(this).replaceWith(touchJS(this).html());commentReplyLinks();webAppLinks();scrollerRefresh()});return false})}}function commentReplyLinks(){touchJS(".commentlist a.comment-reply-link").bind(touchStartOrClick,function(){var a=touchJS(this).closest("li.comment").attr("ID");var b=touchJS("#"+a).find("span.fn:first").text();var d=touchJS(".commentlist ol").attr("ID");var c=touchJS("li#"+a+" .comment-content:first > p").text();touchJS(".comment-reply-box").addClass("fly-in").flyInToggle();touchJS("#box-head h3").html(WPtouch.leave_a_reply+" <span>"+b+"</span>");touchJS("#peek").show();touchJS("input#comment_parent").val(a);touchJS("#container1 textarea").addClass("reply");touchJS("#container2").html(c);return false})}function webAppLinks(){if(WPtouchWebApp){var a=touchJS("a").not(".no-ajax, .email a, .button, .comment-buttons a, ul.menu-tabs a, #pages-wrapper .has_children > a, a.load-more-link, .load-more-comments-link a, #share-popover a, .GTTabs a");a.each(function(){var f=touchJS(this).attr("href");var d=touchJS(this);var c=location.protocol+"//"+location.hostname;var b=location.hostname.split(".");var e=b[1]+"."+b[2];if(typeof wptouch_ignored_urls!="undefined"){touchJS.each(wptouch_ignored_urls,function(g,h){if(f.match(h)){d.addClass("ignored")}})}if(f.match((/[^\s]+(\.(pdf|numbers|pages|xls|xlsx|doc|docx|zip|tar|gz|csv|txt))$/i))){d.addClass("external")}else{if(f.match((/[^\s]+(\.(jpg|jpeg|gif|png|bmp|tiff))$/i))){d.addClass("img-link")}}touchJS(d).unbind("click").bind("click",function(g){if(touchJS(d).hasClass("external")||touchJS(d).parent("li").hasClass("external")){confirmForExternal=confirm(WPtouch.external_link_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{g.preventDefault();g.stopImmediatePropagation()}}else{if(touchJS(d).hasClass("img-link")){return false}else{if(f.match(c)||!f.match("http://")){if(touchJS(d).hasClass("ignored")||touchJS(d).parent("li").hasClass("ignored")){confirmForExternal=confirm(WPtouch.wptouch_ignored_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}else{WPtouchCreateCookie("wptouch-load-last-url",f,365);window.location=f;g.preventDefault()}}else{confirmForExternal=confirm(WPtouch.external_link_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}}}})})}else{touchJS("li.target a").attr("target","_blank")}}function webAppOnly(){if(WPtouchWebApp){var a=touchJS("body.loadsaved").length;touchJS("body").addClass("web-app");touchJS("#account-link-area, #switch, #welcome-message").remove();if(!a){WPtouchEraseCookie("wptouch-load-last-url")}touchJS(".post a").has("img").each(function(){touchJS(this).click(function(c){var b=touchJS(this).attr("href");if(b.match(".jpg")||b.match(".png")||b.match(".jpeg")||b.match(".gif")){c.preventDefault();c.stopImmediatePropagation()}})})}}function welcomeMessage(){if(!WPtouchWebApp){touchJS("a#close-msg").unbind("click").bind("click",function(){WPtouchCreateCookie("wptouch_welcome","1",365);touchJS("#welcome-message").fadeOut(350);return false})}}touchJS.fn.popOverToggle=function(){if(!this.hasClass("open")){this.show().addClass("open")}else{this.removeClass("open").fadeOut(350)}};touchJS.fn.flyInToggle=function(){if(this.hasClass("fly-in")){this.viewportCenter().css("-webkit-transform","scale(1)").css("opacity","1").css("-webkit-transition","350ms")}else{this.viewportCenter().css("-webkit-transform","scale(0)").css("opacity","0").css("-webkit-transition","350ms")}};jQuery.fn.viewportCenter=function(){this.css("position","absolute");this.css("top",((touchJS(window).height()-this.outerHeight())/2)+touchJS(window).scrollTop()+"px");this.css("left",((touchJS(window).width()-this.outerWidth())/2)+touchJS(window).scrollLeft()+"px");this.show();return this};touchJS.fn.webkitSlideToggle=function(){if(!this.hasClass("slide-in")){this.show().addClass("slide-in")}else{this.slideUp(350).removeClass("slide-in")}};function WPtouchCreateCookie(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path="+WPtouch.siteurl}function WPtouchReadCookie(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null}function WPtouchEraseCookie(a){WPtouchCreateCookie(a,"",-1)}touchJS(document).ready(function(){doClassiciPadReady()});