var touchJS=jQuery.noConflict();var WPtouchWebApp=navigator.standalone;var iOS5=navigator.userAgent.match("OS 5_");var addToHomeConfig={animationIn:"bubble",animationOut:"drop",startDelay:550,lifespan:1000*60,expire:60*24*WPtouch.expiryDays,bottomOffset:14,touchIcon:true,arrow:true,message:WPtouch.add2home_message};if(typeof ontouchstart!="undefined"&&typeof ontouchend!="undefined"){var touchStartOrClick="touchstart",touchEndOrClick="touchend"}else{var touchStartOrClick="click",touchEndOrClick="click"}if(window.top!=window.self){window.top.location=self.location.href}function doClassicReady(){touchJS(function(){var i=touchJS("#menu-container > div");touchJS("#tab-inner-wrap-left a").click(function(){i.hide().filter(this.hash).show();touchJS("#tab-inner-wrap-left a").removeClass("selected");touchJS(this).addClass("selected");return false}).filter(":first").click()});touchJS("a#header-menu-toggle").click(function(){touchJS(this).toggleClass("menu-toggle-open");touchJS("#main-menu").opacityToggle(380);return false});touchJS("#main-menu ul li a:not(li.has_children > a)").bind("click",function(){touchJS(this).parent().addClass("active")});touchJS("a#tab-search").click(function(){touchJS("#search-bar").toggleClass("show-search");touchJS(this).toggleClass("search-toggle-open");return false});touchJS("#main-menu").find("li.has_children ul").hide();touchJS("#main-menu ul li.has_children > a").click(function(){touchJS(this).parent().children("ul").opacityToggle(380);touchJS(this).toggleClass("arrow-toggle");touchJS(this).parent().toggleClass("open-tree");return false});if(touchJS("#prowl-message").length){setTimeout(function(){touchJS("#prowl-message").fadeOut(350)},2500)}touchJS(".content img, .content .wp-caption").each(function(){if(!touchJS(this).hasClass("aligncenter")&&touchJS(this).width()>105){touchJS(this).addClass("aligncenter")}});touchJS(".single .p3-img-protect").each(function(){touchJS(".p3-overlay").remove();var i=touchJS(this).html();touchJS(this).replaceWith(i)});touchJS("a#share-toggle").click(function(i){touchJS("#share-links").opacityToggle(330);i.PreventDefault()});touchJS("#action-buttons a, .comment-buttons a, a#cancel-comment-reply-link, a.com-toggle").bind(touchStartOrClick,function(){touchJS(this).addClass("active")}).bind(touchEndOrClick,function(){touchJS(this).removeClass("active")});touchJS("a#instapaper-toggle").click(function(k){var j=prompt(WPtouch.instapaper_username,"");if(j){var i=prompt(WPtouch.instapaper_password,"");if(!i){i="default"}var l={url:document.location.href,username:j,password:i,title:document.title};WPtouchAjax("instapaper",l,function(m){if(m=="1"){alert(WPtouch.instapaper_saved)}else{alert(WPtouch.instapaper_try_again);touchJS("a#instapaper-toggle").click()}})}k.PreventDefault()});touchJS("#email a").click(function(){touchJS("a#share-toggle").click();return true});touchJS(".commentlist li :first, .commentlist img.avatar:first").addClass("first");touchJS("a.com-toggle").bind("click",function(){touchJS("ol.commentlist").toggleClass("hidden");touchJS("img#com-arrow").toggleClass("com-arrow-down");return false});if(touchJS(window).width()>=480){touchJS("body").addClass("landscape")}else{touchJS("body").addClass("portrait")}window.onorientationchange=function(){var j=touchJS("body").scrollTop()+1;var i=window.orientation;switch(i){case 0:case 180:touchJS("body").addClass("portrait").removeClass("landscape");window.scrollTo(0,j,100);break;case 90:case -90:touchJS("body").addClass("landscape").removeClass("portrait");window.scrollTo(0,j,100);break;default:touchJS("body").addClass("portrait").removeClass("landscape")}};var h=touchJS("#header").get(0);h.addEventListener("touchmove",classicTouchMove,false);if(touchJS("#tab-bar").length){var a=touchJS("#tab-bar").get(0);a.addEventListener("touchmove",classicTouchMove,false)}var g=document.location;var f={beforeSubmit:function(){touchJS("#commentform textarea").addClass("loading")},success:function(){touchJS("#commentform textarea").removeClass("loading").addClass("success");alert(WPtouch.comment_success);setTimeout(function(){touchJS("#commentform textarea").removeClass("success")},1500)},error:function(){touchJS("#commentform textarea").removeClass("loading").addClass("error");alert(WPtouch.comment_failure);setTimeout(function(){touchJS("#commentform textarea").removeClass("error")},3000)},resetForm:true,timeout:10000};if(touchJS.isFunction(touchJS.fn.ajaxForm)){touchJS("#commentform").ajaxForm(f)}loadMoreEntries();loadMoreComments();comReplyArrows();classicExcerptToggle();welcomeMessage();webAppLinks();webAppOnly();touchJS("a.login-req, a.comment-reply-login").bind("click",function(){touchJS("a#header-menu-toggle, a#tab-login").click();scrollTo(0,0,1);return false});if(touchJS("body").hasClass("hide-addressbar")){touchJS(window).load(function(){setTimeout(function(){scrollTo(0,0)},1)})}touchJS("a.back-to-top").click(function(){touchJS("body").animate({scrollTop:touchJS("html").offset().top},750);return false});touchJS("a.middle-link").click(function(){touchJS("body").animate({scrollTop:touchJS(".nav-bottom").offset().top},750);return false});var e=["iframe[src^='http://player.vimeo.com']","iframe[src^='http://www.youtube.com']","iframe[src^='http://www.kickstarter.com']","object","embed","video"];var c=touchJS(".content").find(e.join(","));touchJS(c).each(function(){touchJS(this).unwrap().addClass("wptouch-videos").parentsUntil(".content","div:not(.fluid-width-video-wrapper), span").removeAttr("width").removeAttr("height").removeAttr("style")});touchJS(".content").fitVids();touchJS(function(){var i=1;touchJS("input, select, textarea").each(function(){if(this.type!="hidden"){var j=touchJS(this);j.attr("tabindex",i);i++}})});var d=WPtouch.toggle_on,b=WPtouch.toggle_off;touchJS(".on").text(d);touchJS(".off").text(b);touchJS("#switch div").bind(touchEndOrClick,function(){var i=touchJS(this).attr("title");touchJS(".on").toggleClass("active");touchJS(".off").toggleClass("active");setTimeout(function(){window.location=i},500);return false});classicHandleShortcodes()}function classicTouchMove(a){a.preventDefault()}touchJS.fn.opacityToggle=function(a,c,b){return this.animate({opacity:"toggle"},a,c,b)};jQuery.fn.viewportCenter=function(){this.css("position","absolute");this.css("top",((touchJS(window).height()-this.outerHeight())/3)+touchJS(window).scrollTop()+"px");this.css("left",((touchJS(window).width()-this.outerWidth())/2)+touchJS(window).scrollLeft()+"px");this.show();return this};function welcomeMessage(){if(!WPtouchWebApp){touchJS("#welcome-message").show();touchJS("a#close-msg").bind("click",function(){WPtouchCreateCookie("wptouch_welcome","1",365);touchJS("#welcome-message").fadeOut(350);return false})}}function webAppLinks(){if(WPtouchWebApp){var a=touchJS("a").not(".no-ajax, .email a, .feed a, a#header-menu-toggle, .has_children > a, a.load-more-link, .load-more-comments-link a, a#share-toggle, .GTTabs a");a.each(function(){var f=touchJS(this).attr("href"),d=touchJS(this);var c=location.protocol+"//"+location.hostname,b=location.hostname.split("."),e=b[1]+"."+b[2];if(typeof wptouch_ignored_urls!="undefined"){touchJS.each(wptouch_ignored_urls,function(g,h){if(f.match(h)){d.addClass("ignored")}})}if(f.match((/[^\s]+(\.(pdf|numbers|pages|xls|xlsx|doc|docx|zip|tar|gz|csv|txt))$/i))){d.addClass("external")}else{if(f.match((/[^\s]+(\.(jpg|jpeg|gif|png|bmp|tiff))$/i))){d.addClass("img-link")}}touchJS(d).unbind("click").bind("click",function(g){if(touchJS(d).hasClass("external")||touchJS(d).parent("li").hasClass("external")){confirmForExternal=confirm(WPtouch.external_link_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}else{if(touchJS(d).hasClass("img-link")){return false}else{if(f.match(c)||!f.match("http://")){if(touchJS(d).hasClass("ignored")||touchJS(d).parent("li").hasClass("ignored")){confirmForExternal=confirm(WPtouch.wptouch_ignored_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}else{if(touchJS("#main-menu").hasClass("show-menu")){touchJS(this).opacityToggle(380);touchJS("a#header-menu-toggle").toggleClass("menu-toggle-open")}loadPage(f);return false}}else{confirmForExternal=confirm(WPtouch.external_link_text+" \n"+WPtouch.open_browser_text);if(confirmForExternal){return true}else{return false}}}}})})}else{touchJS("li.target a").attr("target","_blank")}}function loadPage(b){var a=touchJS("body.loadsaved").length;if(touchJS("body.ajax-on").length){touchJS("body").append('<div id="progress"></div>');touchJS("#progress").viewportCenter();touchJS(document).unbind();touchJS("#outer-ajax").load(b+" #inner-ajax",function(c){touchJS("#progress").addClass("done");if(a){WPtouchCreateCookie("wptouch-load-last-url",b,365)}else{WPtouchEraseCookie("wptouch-load-last-url")}doClassicReady();scrollTo(0,0,100)})}else{touchJS("body").append('<div id="progress"></div>');touchJS("#progress").viewportCenter();if(a){WPtouchCreateCookie("wptouch-load-last-url",b,365)}setTimeout(function(){window.location=b},550)}}function webAppOnly(){if(WPtouchWebApp){var a=touchJS("body.loadsaved").length;if(!a){WPtouchEraseCookie("wptouch-load-last-url")}touchJS("body").addClass("web-app");touchJS("body.black-translucent").css("margin-top","20px");touchJS("a.comment-reply-link, a.comment-edit-link").remove();setTimeout(function(){touchJS("#progress").remove()},150)}}function classicExcerptToggle(){touchJS("a.excerpt-button").live("click",function(){touchJS(this).toggleClass("open").parent(".post").find(".content").opacityToggle(380);return false})}function classicHandleShortcodes(){if(WPtouchWebApp){var a=jQuery(".wptouch-shortcode-webapp-only");if(a.length){a.show()}}}function loadMoreEntries(){var a=touchJS("a.load-more-link");var b=".ajax-page-target";a.live("click",function(){touchJS(this).addClass("ajax-spinner").text(WPtouch.loading_text);var c=touchJS(this).attr("rel");touchJS("#content").append("<div class='ajax-page-target'></div>");touchJS(b).hide().load(c+" #content .post, #content .load-more-link",function(){touchJS(this).replaceWith(touchJS(this).html());touchJS("a.load-more-link.ajax-spinner").fadeOut(350);webAppLinks();touchJS(".content").fitVids()});return false})}function loadMoreComments(){var a=touchJS("li.load-more-comments-link a");var b=".ajax-page-target";a.live("click",function(){touchJS(this).addClass("ajax-spinner");var c=touchJS(this).attr("href");touchJS("ol.commentlist").append("<div class='ajax-page-target'></div>");touchJS(b).hide().load(c+" ol.commentlist > li",function(){touchJS(this).replaceWith(touchJS(this).html());touchJS(".load-more-comments-link a.ajax-spinner").parent().fadeOut(350);if(WPtouchWebApp){touchJS("a.comment-reply-link, a.comment-edit-link").remove();webAppLinks()}});return false})}function comReplyArrows(){var a=touchJS("ol.commentlist li li > .comment-top");touchJS.each(a,function(){touchJS(a).prepend("<div class='com-down-arrow'></div>")})}function WPtouchCreateCookie(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path="+WPtouch.siteurl}function WPtouchEraseCookie(a){WPtouchCreateCookie(a,"",-1)}touchJS(document).ready(function(){doClassicReady()});